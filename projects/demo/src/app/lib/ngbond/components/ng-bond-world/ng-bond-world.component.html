<svg
  #svg_canvas
  style="position: absolute; top: 0; left: 0"
  style="background: #111"
  width="100%"
  height="100%"
  xmlns="http://www.w3.org/2000/svg"
>
  <defs>
    <pattern id=":S4:" patternUnits="userSpaceOnUse" width="20" height="20">
      <circle r="1" cx="10" cy="10" fill="#313131"></circle>
    </pattern>
  </defs>

  <rect id="canvas_bg" width="100%" height="100%" fill="url(#:S4:)"></rect>
</svg>

<div style="position: absolute; top: 0; left: 0">
  <ng-content></ng-content>
</div>

<svg style="position: absolute; left: 0; top: 0" width="100%" height="100%">
  <defs>
    <!-- A marker to be used as an arrowhead -->
    <marker
      id="arrow"
      viewBox="0 0 10 10"
      refX="5"
      refY="5"
      markerWidth="6"
      markerHeight="6"
      fill="#fff"
      orient="auto-start-reverse"
    >
      <path d="M 0 0 L 10 5 L 0 10 z" />
    </marker>
  </defs>
  @for (link of dragService.links(); track $index) {
    <path
      (click)="onConnectionClick(link)"
      class="draw"
      [attr.stroke]="link().properties.stroke"
      [attr.stroke-width]="link().properties.strokeWidth"
      [attr.d]="link().path"
      [attr.stroke-dasharray]="link().properties.strokeDasharray"
      fill="none"
    />

    @if (link().properties.animate) {

      <!-- Animate along path-->

      <circle r="5" fill="red">
        <animateMotion
          dur="4s"
          repeatCount="indefinite"
          [attr.path]="link().path"
        />
      </circle>

      <circle r="5" fill="red">
        <animateMotion
          dur="4s"
          repeatCount="indefinite"
          [attr.path]="link().path"
        />
      </circle>

      <circle r="5" fill="red">
        <animateMotion
          begin="1s"
          dur="4s"
          repeatCount="indefinite"
          [attr.path]="link().path"
        />
      </circle>

      <circle r="5" fill="red">
        <animateMotion
          begin="2s"
          dur="4s"
          repeatCount="indefinite"
          [attr.path]="link().path"
        />
      </circle>

      <circle r="5" fill="red">
        <animateMotion
          begin="3s"
          dur="4s"
          repeatCount="indefinite"
          [attr.path]="link().path"
        />
      </circle>
    }
  }
</svg>
