<svg #drawSvg class="pentool-canvas" preventselection style="position: absolute; left: 0; top: 0; width: 900px; height: 800px; pointer-events: none">
  @if (svg.mode() === 'pen' && svg.selectedPathElement) {
    <path
      #previewPath
      style="pointer-events: none"
      [attr.d]="svg.selectedPathElement.previewPathD()"
      fill="none"
      [attr.stroke]="svg.selectedPathElement.stroke()"
      [attr.stroke-width]="svg.selectedPathElement.strokeWidth()"
      stroke-dasharray="5 5"
    ></path>
  }
  <g>
    @for (point of svg.selectedPathElement?.points(); track $index) {
      @if (point.controlPoint1) {
        <line style="pointer-events: none" [attr.x1]="point.x" [attr.y1]="point.y" [attr.x2]="point.controlPoint1.x" [attr.y2]="point.controlPoint1.y" stroke="#ae8bf4" stroke-width="1"></line>
      }
      @if (point.controlPoint2) {
        <line style="pointer-events: none" [attr.x1]="point.x" [attr.y1]="point.y" [attr.x2]="point.controlPoint2.x" [attr.y2]="point.controlPoint2.y" stroke="#ae8bf4" stroke-width="1"></line>
      }
    }
  </g>
  @for (p of svg.paths(); track $index) {
    <path
      style="pointer-events: auto"
      [path]="p"
      appPathDirective
      [attr.fill]="p.fill()"
      [attr.stroke]="p.stroke()"
      [attr.stroke-width]="p.strokeWidth()"
      [attr.stroke-dasharray]="p.strokeDasharray()"
      [attr.stroke-dashoffset]="p.strokeDashoffset()"
      [attr.stroke-linejoin]="p.strokeLineJoint()"
      [attr.stroke-linecap]="p.strokeLineCap()"
      (mousedown)="svg.onPathClick(p, $event)"
      (mouseover)="svg.mouseOverPath(p, $event)"
      (mouseout)="svg.mouseOutPath(p, $event)"
      [attr.d]="p.d()"
    ></path>
  }
</svg>

<div class="control-container">
  @for (point of svg.selectedPathElement?.points(); track $index) {
    <path-point (click)="svg.onPointClick(point)" [point]="point" class="control-point" [style.left.px]="point.x - 5" [style.top.px]="point.y - 5" />

    @if (point.controlPoint1) {
      <path-point
        (click)="svg.onPointClick(point.controlPoint1)"
        [point]="point.controlPoint1"
        class="control-point control-point-handle"
        [style.left.px]="point.controlPoint1.x - 5"
        [style.top.px]="point.controlPoint1.y - 5"
      />
    }

    @if (point.controlPoint2) {
      <path-point
        (click)="svg.onPointClick(point.controlPoint2)"
        [point]="point.controlPoint2"
        class="control-point control-point-handle"
        [style.left.px]="point.controlPoint2.x - 5"
        [style.top.px]="point.controlPoint2.y - 5"
      />
    }
  }
</div>
