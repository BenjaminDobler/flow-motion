<svg #svg_canvas style="position: absolute; top: 0; left: 0" style="background: #111" width="100%" height="100%" xmlns="http://www.w3.org/2000/svg">
  <!-- <defs>
    <pattern id=":S4:" patternUnits="userSpaceOnUse" width="20" height="20">
      <circle r="1" cx="10" cy="10" fill="#313131"></circle>
    </pattern>
  </defs>

  <rect id="canvas_bg" width="100%" height="100%" fill="url(#:S4:)"></rect> -->
</svg>

<div class="content-container" [style.transform]="`scale(${dragService.scale()})`">
  
  <ng-template #insert_slot></ng-template>
  <ng-content></ng-content>
</div>


@let group = selectionManager.selectedGroup();

<!--draw selection hightlights-->
<svg style="position: absolute; left: 0; top: 0; pointer-events: none" width="100%" height="100%">
  <!-- @for (selection of selectionManager.selectionTargets(); track $index) {
    <rect [attr.x]="selection.gX()" [attr.y]="selection.gY()" [attr.width]="selection.width()" [attr.height]="selection.height()" fill="none" stroke="#2558ce" stroke-width="1"></rect>
  } -->

  @if (group) {
    <rect style="pointer-events: none" [attr.x]="group.x" [attr.y]="group.y" [attr.width]="group.width" [attr.height]="group.height" fill="none" stroke="#2558ce" stroke-width="1"></rect>
  }

  @let rect = selectionRect();

  @if (rect) {
    <rect
      style="pointer-events: none"
      [attr.x]="rect.x"
      [attr.y]="rect.y"
      [attr.width]="rect.width"
      [attr.height]="rect.height"
      stroke-dasharray="4 4"
      fill="#0C8CE9"
      fill-opacity="0.2"
      stroke="#0C8CE9"
      stroke-width="1"
    ></rect>
  }
</svg>
@if (group) {
  <div style="position: absolute; left: 0; top: 0" [style.transform]="`translate(${group.x}px, ${group.y - 30}px)`">
    <div class="group-info-pill">{{ group.x | number: '1.0-0' }} x {{ group.y | number: '1.0-0' }}</div>
  </div>
  <div style="position: absolute; left: 0; top: 0" [style.transform]="`translate(${group.x + group.width / 2}px, ${group.y + group.height + 5}px)`">
    <div class="group-info-pill">{{ group.width | number: '1.0-0' }} x {{ group.height | number: '1.0-0' }}</div>
  </div>
}

<svg style="position: absolute; left: 0; top: 0; pointer-events: none" width="100%" height="100%">
  @for (line of selectionManager.helpLines(); track $index) {
    <line [attr.x1]="line.x1" [attr.y1]="line.y1" [attr.x2]="line.x2" [attr.y2]="line.y2" stroke-dasharray="4 4" stroke="#ff0000" stroke-width="1" />
  }
</svg>

<svg style="position: absolute; left: 0; top: 0; pointer-events: none" width="100%" height="100%">
  @for (dropTarget of selectionManager.dropTargets(); track $index) {
    <rect [attr.x]="dropTarget.gX()" [attr.y]="dropTarget.gY()" [attr.width]="dropTarget.width()" [attr.height]="dropTarget.height()" fill="none" stroke="#ff0000" stroke-width="3" />
  }
</svg>
